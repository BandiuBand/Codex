name: flaky_failure_demo_agent
description: Demo agent that forces validator failure to illustrate retry cap handling.

input_schema: null
output_schema: null

serialize:
  enabled: true
  base_dir: "./data/runs"
  per_step: true

entry_step_id: flaky_step
end_step_ids:
  - fail

steps:
  flaky_step:
    kind: tool
    tool_name: flaky
    tool_params:
      counter_var: flaky_fail_attempt
      message: "This one will fail"
    save_mapping:
      attempt: attempt
      flaky_message: message
    validator_agent_name: cerber_retry_demo
    validator_params:
      force_fail: "true"
      fail_message: "Validator forced to fail"
    validator_policy:
      max_retries: "1"
    transitions:
      - target_step_id: fail
        condition:
          type: always

  fail:
    kind: tool
    tool_name: echo
    tool_params:
      text: "Failure path after attempt {attempt}: {flaky_message}"
    save_mapping:
      message: output_text
    validator_agent_name: null
    validator_params: {}
    validator_policy: {}
    transitions: []
