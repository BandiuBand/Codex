name: plan_executor
title_ua: Виконання плану з перевіркою
description_ua: LLM симулює виконання кроків і перевірку їх відповідності критеріям
kind: atomic
inputs:
- name: завдання
- name: кроки
- name: критерії
- name: max_reviews
- name: stop_agent_execution
  type: bool
  default: false
locals:
- name: parse_json
  value: true
- name: prompt
  value: 'Ти агент-"Цербер", який виконує та перевіряє план задачі.

    Завдання: {завдання}

    Кроки: {кроки}

    Критерії: {критерії}

    Максимальна кількість перевірок для одного кроку: {max_reviews}


    Для кожного кроку:

    - Опиши короткий результат виконання.

    - Додай поле evidence: список конкретних доказів (шляхи змінених файлів, команди,
    хеші артефактів тощо). Порожні або відсутні evidence неприпустимі.

    - Порівняй із відповідним критерієм. Крок без evidence автоматично відхиляється.

    - Якщо крок не проходить, врахуй, що він може бути перероблений ще раз до {max_reviews}
    разів.


    Поверни тільки JSON з полями:

    - executed_steps: список об''єктів {{"крок", "критерій", "результат", "коментар",
    "прийнято", "спроб", "evidence"}}; evidence обов''язково список і має містити
    хоча б один елемент

    - passed: true/false чи пройшов увесь план перевірку (true тільки якщо всі кроки
    прийняті та з evidence)

    - cerber_comment: стислий підсумок від Цербера. Згадай, якщо якесь evidence відсутнє
    або відхилене.

    - needs_retry: чи треба повторити будь-який крок (true, якщо evidence порожній
    або кроки не прийняті)

    - summary: загальний підсумок виконання

    '
outputs:
- name: результат
- name: output_json
- name: json_error
- name: виконані_кроки
- name: пройшло_перевірку
- name: коментар_цербера
- name: потрібно_повторити
- name: результат_виконання
executor: llm
