name: chat_agent
title_ua: Місток із користувачем
description_ua: Надсилає текст користувачу та повертає його відповідь
kind: atomic
inputs:
- name: message_to_user
- name: needs_response
- name: stop_agent_execution
  type: bool
  default: false
locals:
- name: user_message
  value: ''
- name: code
  value: "# Чат-агент діє синхронно: ставить питання користувачу і чекає відповіді\n\
    # через глобальний chat_gateway без повернення статусу \"blocked\".\nfrom agentfw.runtime.chat_agent\
    \ import ChatAgentGateway\n\ngateway = locals().get(\"chat_gateway\")\nif not\
    \ isinstance(gateway, ChatAgentGateway):\n    raise RuntimeError(\"chat_gateway\
    \ недоступний для чат-агента\")\n\ntext = (message_to_user or \"\").strip()\n\
    wants_reply = True if needs_response is None else bool(needs_response)\n\nif wants_reply:\n\
    \    if user_message:\n        # Уже маємо відповідь користувача — просто повертаємо\
    \ її.\n        user_message = str(user_message)\n    else:\n        # Агент формулює\
    \ питання і блокується, доки користувач не відповість.\n        gateway.ask_user(\"\
    chat_agent\", text or \"Очікуємо завдання від користувача\")\n        user_message\
    \ = gateway.wait_user()\nelse:\n    if text:\n        gateway.post_agent(\"chat_agent\"\
    , text)\n    user_message = user_message or \"\"\n"
outputs:
- name: user_message
executor: python
