name: chat_agent
title_ua: Місток із користувачем
description_ua: Надсилає текст користувачу та повертає його відповідь
kind: atomic
executor: python
inputs:
  - name: message_to_user
  - name: needs_response
locals:
  - name: user_message
    value: ""
  - name: code
    value: |
      # Якщо потрібна відповідь користувача, але значення user_message відсутнє,
      # піднімаємо BlockedExecution із missing_inputs/why_blocked, щоб зовнішній
      # чат показав питання й зачекав на наступне реальне повідомлення.
      from agentfw.runtime.engine import BlockedExecution

      text = message_to_user or ""
      wants_reply = True if needs_response is None else bool(needs_response)

      if wants_reply and not user_message:
          # Блокуємо виконання лише з поясненням/питанням,
          # не вимагаючи конкретних missing_inputs.
          reason = text or "Очікуємо відповідь користувача"
          raise BlockedExecution(
              questions_to_user=[text] if text else None,
              why_blocked=f"{reason}. Актуального повідомлення від користувача немає — чат чекає на новий текст.",
          )

      user_message = user_message or ""
outputs:
  - name: user_message
