name: data_review_schema_validate
title_ua: Валідація результату перевірки даних
description_ua: Нормалізує JSON перевірки готовності та виставляє прапори
description: Normalizes data review JSON and enforces required flags
kind: atomic
inputs:
- name: review_json
- name: json_error_in
  default: ""
- name: stop_agent_execution
  type: bool
  default: false
locals:
- name: code
  value: "import json as json_lib\n\nerror = str(json_error_in) if json_error_in else ''\nsource = review_json\nif isinstance(source, str):\n    try:\n        source = json_lib.loads(source)\n    except Exception as exc:  # noqa: BLE001\n        error = error or f'Invalid JSON: {exc}'\n        source = {}\nif not isinstance(source, dict):\n    error = error or 'Expected object for data_review payload'\n    source = {}\nneeds_more_info = bool(source.get('needs_more_info'))\nclarifications = (source.get('clarifications') or '').strip()\ncontext_summary = (source.get('context_summary') or '').strip()\nuser_answer = (source.get('user_answer') or '').strip()\nok_flag = source.get('ok')\nif ok_flag is None:\n    ok_flag = not needs_more_info\nelse:\n    ok_flag = bool(ok_flag)\nvalidated_json = {\n    'ok': ok_flag,\n    'needs_more_info': needs_more_info,\n    'clarifications': clarifications,\n    'context_summary': context_summary,\n    'user_answer': user_answer,\n}\njson_error = error\n"
outputs:
- name: validated_json
- name: ok
- name: needs_more_info
- name: clarifications
- name: context_summary
- name: user_answer
- name: json_error
executor: python
