name: flaky_retry_demo_agent
description: Demo agent that shows validator-driven retries with FlakyTool.

input_schema: null
output_schema: null

serialize:
  enabled: true
  base_dir: "./data/runs"
  per_step: true

entry_step_id: flaky_step
end_step_ids:
  - done

steps:
  flaky_step:
    kind: tool
    tool_name: flaky
    tool_params:
      counter_var: flaky_attempt
      message: "Working on it"
    save_mapping:
      attempt: attempt
      flaky_message: message
    validator_agent_name: cerber_retry_demo
    validator_params:
      accept_after: "2"
    validator_policy:
      max_retries: "3"
    transitions:
      - target_step_id: done
        condition:
          type: always

  done:
    kind: tool
    tool_name: echo
    tool_params:
      text: "Flaky step finished after attempt {attempt}: {flaky_message}"
    save_mapping:
      message: output_text
    validator_agent_name: null
    validator_params: {}
    validator_policy: {}
    transitions: []
