# План виправлень для узгодження з CONCEPT_LOCK (лише план, без змін коду в цій ітерації)

1. **agentfw/web/static/index.html** — перебудувати розмітку: канва сама є агентом, відобразити крайові порти поточного агента (inputs зліва, locals зверху, outputs справа) без сторонніх панелей; додати елементи для створення/видалення цих змінних прямо на канві.  
   Тест після кроку: запустити веб-редактор і перевірити в DOM наявність крайових портів та кнопок додавання/видалення змінних; переконатися, що немає інших панелей.  

2. **agentfw/web/static/styles.css** — стилізувати крайові зони, картки агентів, порти та лінії так, щоб портові блоки були компактними прямокутниками в потрібних місцях (inputs ліворуч, locals зверху, outputs праворуч), без перекриття канви.  
   Тест після кроку: візуально у браузері перевірити розташування портів і ліній; переконатися, що канва чиста від зайвих блоків.  

3. **agentfw/web/static/app.js** — реалізувати повний функціонал:  
   - CRUD змінних поточного агента через крайові порти;  
   - відображення всіх портів дочірніх агентів (inputs/locals/outputs) без втрат;  
   - drag&drop з’єднання між портами поточного агента та портами дочірніх агентів, включно з напрямком output/locals дочірнього → контекстні outputs агента;  
   - коректний ререндер після змін.  
   Тест після кроку: ручний сценарій у UI — створити змінні агента, додати дочірній агент, протягнути лінії від крайових inputs до inputs дочірнього та від outputs дочірнього до крайових outputs, зберегти та перезавантажити, переконатися, що зв’язки збереглись.  

4. **agentfw/runtime/engine.py** — узгодити виконання з новими bindings: читати прив’язки контексту → inputs дочірніх, записувати outputs дочірніх → контекстні змінні агента, щоб результати потрапляли у глобальний state.  
   Тест після кроку: `python run.py test` і окремо ручний запуск `POST /api/run/workflow_demo` з перевіркою, що outputs контексту заповнені згідно зв’язків.  

5. **agents/workflow_demo.yaml** — оновити демо: чіткі inputs/locals/outputs, прив’язки до крайових портів, використання атомарного агента розгалуження.  
   Тест після кроку: `POST /api/run/workflow_demo` і вивчити vars/log, щоб гілкування працювало та всі контекстні змінні заповнювались.  

6. **tests/** — додати/оновити тести:  
   - unit/integration для drag-з’єднань контекст→input дочірнього та output дочірнього→контекст;  
   - UI-представлення портів поточного агента на краях (наприклад, snapshot/DOM-тести, якщо можливо);  
   - API/engine для workflow_demo.  
   Тест після кроку: `python run.py test` (оновлений набір) і, за можливості, автоматизований DOM тест на наявність крайових портів.  

7. **Ручна перевірка UI** — фінальний прохід: створення/редагування/збереження агента з крайовими портами, drag&drop між усіма портами, українські підписи, відсутність додаткових панелей. Якщо щось не працює — повернутись до відповідного кроку вище та виправити.  
   Тест після кроку: покрити сценарії додавання змінних, зв’язків, переміщення карток між lanes, збереження/перезавантаження без втрати зв’язків.
