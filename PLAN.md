# План виправлень для узгодження з CONCEPT_LOCK (лише план, без змін коду в цій ітерації)

1. **agentfw/web/static/index.html** — перебудувати розмітку: канва сама є агентом, крайові порти поточного агента (inputs зліва, locals зверху, outputs справа) додаються/видаляються прямо на канві, жодних додаткових панелей.  
   Тест і перевірка після кроку:  
   - Запустити веб-редактор, у DOM мають бути крайові порти та кнопки додавання/видалення змінних, сторонніх панелей немає.  
   - Переконатися вручну, що відповідність CONCEPT_LOCK збережена (змінні тільки на краях канви). Якщо тест/перевірка не проходить — виправити і повторити крок.

2. **agentfw/web/static/styles.css** — стилізувати крайові зони, картки агентів, порти й лінії: компактні прямокутники, розміщення inputs ліворуч, locals зверху, outputs праворуч, без перекриття канви.  
   Тест і перевірка після кроку:  
   - Візуальна перевірка у браузері розташування портів/ліній та відсутність зайвих блоків.  
   - Перевірка на відповідність CONCEPT_LOCK (розташування змінних і відсутність додаткових панелей). Якщо не відповідає — виправити й повторити.

3. **agentfw/web/static/app.js** — реалізувати функціонал: CRUD змінних поточного агента через крайові порти; повне відображення портів дочірніх агентів (inputs/locals/outputs); drag&drop з’єднання між портами агента та дочірніх (у т.ч. output/locals дочірнього → контекстні outputs агента); коректний ререндер.  
   Тест і перевірка після кроку:  
   - Ручний сценарій у UI: створити змінні агента, додати дочірній агент, протягнути лінії (крайові inputs → inputs дочірнього, outputs дочірнього → крайові outputs), зберегти, перезавантажити, перевірити збереження зв’язків.  
   - Перевірка відповідності CONCEPT_LOCK (тільки змінні+зв’язки, без додаткових панелей, українські підписи). Якщо щось падає/не зберігається/не відповідає концепції — виправити й повторити цей крок.

4. **agentfw/runtime/engine.py** — узгодити виконання з новими bindings: читати контекст → inputs дочірніх, писати outputs дочірніх → контекстні змінні агента (глобальний state).  
   Тест і перевірка після кроку:  
   - `python run.py test`;  
   - ручний `POST /api/run/workflow_demo`, переконатися, що контекстні outputs заповнені згідно прив’язок;  
   - перевірка на відповідність CONCEPT_LOCK (зв’язки змінна→змінна, серіалізація). Якщо не проходить — виправити й повторити.

5. **agents/workflow_demo.yaml** — оновити демо: явні inputs/locals/outputs, прив’язки до крайових портів, використання атомарного агента розгалуження.  
   Тест і перевірка після кроку:  
   - `POST /api/run/workflow_demo`, проаналізувати vars/log для коректного гілкування;  
   - відповідність CONCEPT_LOCK (2 lanes, умовний запуск, drag&drop-сумісні bindings). Якщо ні — виправити й повторити.

6. **tests/** — оновити/додати тести:  
   - unit/integration для drag-з’єднань контекст→input дочірнього та output дочірнього→контекст;  
   - (за можливості) DOM/snapshot на наявність крайових портів;  
   - API/engine для workflow_demo.  
   Тест і перевірка після кроку:  
   - `python run.py test` (оновлений набір);  
   - перевірка відповідності CONCEPT_LOCK (усі вимоги з документа). Якщо не проходить — виправити й повторити цей крок.

7. **Ручна фінальна перевірка UI** — прогнати сценарії: створення/редагування/збереження агента з крайовими портами, drag&drop між усіма портами, переміщення карток між lanes, українські підписи, відсутність додаткових панелей.  
   Тест і перевірка після кроку:  
   - Ручний прогін описаних сценаріїв;  
   - Перевірка відповідності CONCEPT_LOCK. Якщо щось не працює — повернутись до відповідного кроку вище, виправити й повторити всі тести до успіху.
