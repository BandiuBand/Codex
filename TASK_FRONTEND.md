# TASK_FRONTEND.md — Codex: фронтенд-редактор агентів (UI українською)

## 0) Блокер: UI не має падати на init
Твій стек:
`app.js:66 ... innerHTML of null`
=> JS пробує звернутися до DOM-елемента, якого немає, і валить весь UI.

**Вимога:**
- ЖОДНА помилка в init не повинна робити "пустий UI".
- Якщо елемент не знайдений — показати повідомлення в українському toast/банері і продовжити, або деградувати функцію.

## 1) Ціль UI
Зробити редактор, де **агент == схема**, а “atomic” лише відрізняється бейджем executor’а.
Без “tools/nodes” як окремих сутностей.

## 2) Файли, які треба переробити/додати
- `agentfw/web/templates/index.html`  (або аналог)
- `agentfw/web/static/app.js`
- `agentfw/web/static/styles.css`
- `agentfw/web/static/i18n/uk.json` (НОВИЙ)

## 3) Українська мова: обов’язково
### 3.1 i18n
**Файл:** `agentfw/web/static/i18n/uk.json`

Мінімальний набір ключів:
- `title.app`: "Редактор агентів Codex"
- `sidebar.agents`: "Агенти"
- `sidebar.search`: "Пошук…"
- `panel.inputs`: "Вхідні змінні"
- `panel.internals`: "Внутрішні змінні"
- `panel.outputs`: "Вихідні змінні"
- `panel.body`: "Тіло"
- `panel.run`: "Запуск"
- `run.select_agent`: "Оберіть агента"
- `run.input_json`: "Вхід (JSON)"
- `run.output_json`: "Вихід (JSON)"
- `run.execute`: "Запустити"
- `error.dom_missing`: "Помилка інтерфейсу: відсутній елемент {id}"

**Вимога:** в UI не лишається англійських підписів.

## 4) Основний екран (канва + смуги виконання)
### 4.1 Канва поділена на вертикальні смуги (lanes)
- кожна смуга відповідає `LaneSpec`
- всередині смуги агент-елементи виконуються паралельно
- зліва направо — послідовність lane

**UI:**
- кнопка “Додати смугу”
- смуга має назву українською
- drag&drop агентів зі списку в конкретну смугу

## 5) Вузол агента на канві
Кожен елемент — прямокутник:
- зверху: назва агента (ui_title_uk)
- бейдж: `LLM` / `Python` / `Shell` якщо atomic
- зліва: порти inputs (іконки/кружки)
- справа: порти outputs
- зверху (малими): internal vars (клік відкриває редагування)

## 6) З’єднання змінних (drag connection)
### 6.1 Правило
Перетягування:
- від output порту -> до input порту
створює binding:
- `input_bindings[child_input] = parent_var`

**Вимога:**
- binding одразу відображається лінією на канві
- можна видалити зв’язок
- підтримати binding з internal -> input (для “default values” як ти описував)

## 7) Панель редагування агента (праворуч)
При кліку на агент-елемент:
- вкладка “Вхідні змінні” (список VarSpec, редагування ui_label_uk/type)
- вкладка “Внутрішні змінні”
- вкладка “Вихідні змінні”
- поле “Тіло”:
  - це редагування значення `body_var` (внутрішньої змінної)
  - UI не вводить окрему концепцію “prompt/code/command”, просто текст змінної
- секція “Умова виконання”:
  - dropdown mode: `var_bool | agent_bool | python_expr`
  - поле ref

## 8) Форма запуску агентів (обов’язково)
Додати екран/панель “Запуск”:
- dropdown зі списком агентів з `GET /api/agents`
- textarea “Вхід (JSON)”
- кнопка “Запустити”
- textarea “Вихід (JSON)”
- область “Trace” (список подій)

Запуск через:
- `POST /api/agents/{name}/run`

## 9) Фікс конкретного бага `innerHTML of null`
У `agentfw/web/static/app.js`:
- функція `populateToolAndConditionOptions` НЕ МАЄ падати, якщо DOM-елемент не знайдений.
- зробити:
  - `const el = document.getElementById("..."); if (!el) { showError(i18n.error.dom_missing); return; }`
- `init()` запускати строго після `DOMContentLoaded`.

## 10) Definition of Done
- UI відкривається без помилок у консолі.
- Усі підписи українською.
- Є смуги (lanes), drag&drop агентів, з’єднання змінних лініями.
- Є панель редагування VarSpec та body_var.
- Є форма запуску агентів зі списком і показом output+trace.
